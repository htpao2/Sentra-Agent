# LLM Provider (OpenAI-compatible)
OPENAI_BASE_URL=https://yuanplus.cloud/v1
OPENAI_API_KEY=sk-REPLACE_ME
OPENAI_MODEL=gpt-4.1-mini
OPENAI_TEMPERATURE=0.2
OPENAI_MAX_TOKENS=4096
OPENAI_TOOL_CHOICE=auto
# Tool-Calling Strategy
# native: 仅使用模型提供商的原生函数调用（tools）
# fc: 强制使用 <sentra-tools> 文本块（ReAct 行协议），不依赖原生 tools
# auto: 优先原生 tools，失败时自动回退到 <sentra-tools>
TOOL_STRATEGY=fc
 # 不限 token：如需不限，设置 OPENAI_MAX_TOKENS=-1（将省略 max_tokens）

# FC Provider (used when TOOL_STRATEGY=fc, or as fallback in auto)
# 若未设置，将回退到 OPENAI_* 配置
FC_BASE_URL=https://yuanplus.cloud/v1
FC_API_KEY=sk-REPLACE_ME
FC_MODEL=gpt-4o-mini
FC_TEMPERATURE=0.2
# -1 或留空：chatCompletion 将省略 max_tokens
FC_MAX_TOKENS=-1
# 输出格式（本项目标准：sentra => 使用 <sentra-tools> ReAct 行协议）
FC_FORMAT=sentra
# 重试次数（FC 模式）
# 规划阶段最大全重试次数（当 steps 为空或全部被过滤时触发）
FC_PLAN_MAX_RETRIES=3
# 参数生成/纠错阶段最大全重试次数（当未解析到调用或缺少必填字段时触发）
FC_ARG_MAX_RETRIES=3
# 评估阶段（final_judge）最大全重试次数
FC_EVAL_MAX_RETRIES=3
# 最终总结（final_summary）最大全重试次数
FC_SUMMARY_MAX_RETRIES=3

# FC Stage Sampling (optional)
# 若未设置，则回退到 FC_TEMPERATURE/top_p 默认与代码内下限
FC_PLAN_TEMPERATURE=0.1
FC_PLAN_TOP_P=
FC_EVAL_TEMPERATURE=0.1
FC_EVAL_TOP_P=
FC_SUMMARY_TEMPERATURE=0.1
FC_SUMMARY_TOP_P=

# Rerank (tool candidate reordering)
# 仅基于每个插件 meta.realWorldAction 文本，使用 judgeReason 作为 query
RERANK_ENABLE=true
RERANK_BASE_URL=https://yuanplus.cloud/v1
RERANK_API_KEY=sk-REPLACE_ME
RERANK_MODEL=BAAI/bge-reranker-v2-m3
RERANK_CANDIDATE_K=-1      # 设为 -1 表示不过滤候选（全部进入精排）
RERANK_TOP_N=-1              # 设为 -1 表示不裁剪（返回与允许集合均为全量）
RERANK_USE_DESC_FALLBACK=true
RERANK_TIMEOUT_MS=12000
RERANK_MAX_SUBQUERIES=-1       # 设为 -1 或 0 表示不限制（全部子查询参与精排）
RERANK_AGG_ALPHA=0.1
RERANK_AGG_BETA=0.5
RERANK_AGG_GAMMA=0.4

# Summarizer model (optional, defaults to same as above)
SUMMARIZER_BASE_URL=https://yuanplus.cloud/v1
SUMMARIZER_API_KEY=sk-REPLACE_ME
SUMMARIZER_MODEL=gpt-4.1-mini
SUMMARIZER_TEMPERATURE=0.1

# Judge model (pre-run tool necessity)
JUDGE_BASE_URL=https://yuanplus.cloud/v1
JUDGE_API_KEY=sk-REPLACE_ME
JUDGE_MODEL=gpt-5-mini
JUDGE_TEMPERATURE=0.1
JUDGE_MAX_TOKENS=-1

# Reasoner model (separate from tool-calling model)
REASONER_BASE_URL=https://yuanplus.cloud/v1
REASONER_API_KEY=sk-REPLACE_ME
REASONER_MODEL=gemini-2.5-flash-preview-09-2025
REASONER_TEMPERATURE=0.2
# -1 或留空：chatCompletion 将省略 max_tokens
REASONER_MAX_TOKENS=-1

# Planner/Executor Budgets
PLAN_MAX_STEPS=8
PLAN_MAX_CONCURRENCY=3
PLAN_TOTAL_TIME_BUDGET_MS=60000
TOOL_TIMEOUT_MS=15000
TOOL_COOLDOWN_DEFAULT_MS=2000
TOOL_COOLDOWN_FUNC_RETRY=0        # 函数内冷却重试次数（建议0，改由调度器延迟重排）

# Tool Result Cache (aiName+args -> result)
TOOL_CACHE_ENABLE=false           # 开启结果缓存（仅缓存成功结果）
TOOL_CACHE_TTL_SEC=600            # 缓存TTL（秒）
TOOL_CACHE_ALLOWLIST=             # 逗号分隔，仅这些 aiName 会被缓存；留空表示全部允许
TOOL_CACHE_DENYLIST=              # 逗号分隔，这些 aiName 将不缓存（优先生效）

# Per-tool / Provider 并发限流（大并发下建议开启）
PLANNER_TOOL_CONCURRENCY_DEFAULT=5         # 同一工具(aiName)默认并发上限
PLANNER_PROVIDER_CONCURRENCY_DEFAULT=10    # 同一提供方(provider)默认并发上限，如 local / external:serverId
# 覆盖示例（将空格替换为下划线，全部大写）：
# PLANNER_TOOL_CONCURRENCY__LOCAL__WEB_PARSER=1
# PLANNER_PROVIDER_CONCURRENCY__LOCAL=4

# Governance
DEFAULT_SCOPE=global
DEFAULT_TENANT_ID=default

# Redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_METRICS_PREFIX=sentra:mcp:metrics
REDIS_CONTEXT_PREFIX=sentra:mcp:ctx

# MCP Server
MCP_SERVER_TRANSPORT=stdio
HTTP_PORT=3001
ALLOWED_HOSTS=127.0.0.1,localhost

# Runner (global repair & diversification)
RUN_MAX_REPAIRS=1            # 全局修复循环上限（评估失败后回滚重试的轮数）
RETRY_DIVERSIFY=true         # 重试时要求多样化（避免重复失败路径），影响强化提示词

# Logging
LOG_LEVEL=info
LOG_DIR=logs
LOG_TIMESTAMP_LOCAL=true
LOG_COLOR_META=true
LOG_DIM_META=false
# 逗号分隔的日志分组标签白名单（控制台排版）
LOG_PRETTY_LABELS=PLAN,PLAN_STEP,STEP,ARGS,RESULT,PLUGIN,REDIS,MCP,RUN,EVAL,RETRY

# Feature Flags
ENABLE_TOOL_STREAMING=false
ENABLE_HISTORY_SUMMARY=true
HISTORY_SUMMARY_TRIGGER=8000  # when history tokens/length over threshold
ENABLE_VERBOSE_STEPS=true      # 输出每一步的详细日志（参数/结果预览）
VERBOSE_PREVIEW_MAX=400        # 日志中预览字段最大长度
CONTEXT_MAX_DEPTH=2            # 历史上下文回溯层级
CONTEXT_STRING_MAX=160         # 单字段字符串截断长度
CONTEXT_PREVIEW_KEYS=8         # 预览键数量上限
CONTEXT_PREVIEW_ARRAY_ITEMS=3  # 数组预览项上限
RECENT_CONTEXT_LIMIT=5         # recentResults 窗口
EVAL_RETRY_ON_FAIL=true        # 失败后是否局部重试
EVAL_MAX_RETRIES=1             # 最大重试次数
EVAL_USE_PRETHOUGHT=false      # 评估阶段是否注入前置思考（默认关闭以减少偏置）
SUMMARY_USE_PRETHOUGHT=false   # 总结阶段是否注入前置思考（默认关闭以减少偏置）
PLAN_USE_PRETHOUGHT=false      # 规划阶段是否运行前置思考（native & FC；关闭可省略该步骤）

# Embeddings (用于向量记忆)
EMBEDDING_BASE_URL=https://yuanplus.cloud/v1
EMBEDDING_API_KEY=sk-REPLACE_ME
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# Memory (Redis向量记忆，应用层相似度)
MEM_ENABLE=false
MEM_NAMESPACE=sentra-mcp
MEM_PREFIX=sentra:mcp:mem
MEM_TOP_K=5
MEM_TOOL_TOP_K=3
MEM_MIN_SCORE=0.7
MEM_CANDIDATE_POOL=200   # 近似召回池大小，越大越准也越耗时
MEM_ONLY_SUCCESSFUL=true # 工具记忆仅使用成功案例
MEM_ENABLE_REUSE=true
MEM_REUSE_THRESHOLD=0.97

# Memory RediSearch (optional)
MEM_ENABLE_REDISEARCH=false
MEM_RS_INDEX=mem_idx
MEM_RS_DIM=1536                   # 向量维度（需与嵌入模型一致，如 text-embedding-3-small=1536）
MEM_RS_DISTANCE=COSINE   # COSINE | L2 | IP
MEM_RS_M=16
MEM_RS_EF_CONSTRUCTION=200
MEM_RS_EF_RUNTIME=200

PLAN_MULTI_ENABLE=true
PLAN_MULTI_CANDIDATES=3

# Plan audit (reasoner-based selection)
PLAN_AUDIT_ENABLE=true
PLAN_AUDIT_VOTERS=1