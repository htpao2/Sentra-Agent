# ===== 日志配置 =====
# 日志级别：DEBUG（详细）、INFO（常规）、WARN（警告）、ERROR（仅错误）
LOG_LEVEL=DEBUG

# ===== WebSocket 配置 =====
# QQ OneBot 协议服务器地址
WS_HOST=localhost

# QQ OneBot 协议服务器端口
WS_PORT=6702

# WebSocket 请求超时时间（毫秒）
WS_TIMEOUT=60000

# WebSocket 重连间隔（毫秒）
# 当连接断开或失败时，每隔此间隔尝试重连一次
WS_RECONNECT_INTERVAL_MS=10000

# WebSocket 最大重连次数
# 达到此次数仍未成功则停止重连并记录错误
WS_MAX_RECONNECT_ATTEMPTS=60

# ===== Agent 配置 =====
# Agent 角色预设文件名称（存放在 agent-presets 目录下）
# 示例：default.txt, assistant.txt, developer.txt
AGENT_PRESET_FILE=default.txt

# ===== AI API 配置 =====
# OpenAI 兼容 API 基础地址
API_BASE_URL=https://api.openai.com/v1

# API 密钥
API_KEY=your_api_key_here

# 主要 AI 模型（用于所有对话场景）
# 示例：gpt-5-mini, gemini-2.5-flash-preview-09-2025, ds，k2(这个还可以-thinking)
MAIN_AI_MODEL=gemini-2.5-pro

# 温度参数（0-2，越高越随机）
# 建议 0.5-0.8，配合优化后的提示词可保证格式稳定性
TEMPERATURE=0.7

# 最大 token 数（-1 表示不限制）
MAX_TOKENS=4096

# 最大重试次数（网络错误时）
MAX_RETRIES=3

# 请求超时时间（毫秒）
TIMEOUT=60000

# 是否启用格式修复：不合规时尝试自动修复
ENABLE_FORMAT_REPAIR=true

# 修复模型
# 建议：gpt-4.1-mini
REPAIR_AI_MODEL=gpt-4.1-mini

# ENABLE_SMART_REPLY：是否启用智能回复（false 时总是回复）
ENABLE_SMART_REPLY=true

# BOT_NAMES：Bot 名称列表（逗号分隔，消息中提及这些名称会增加回复概率）
BOT_NAMES=小助手,助手,bot,机器人

# MIN_REPLY_INTERVAL：最小回复间隔（秒，避免过于频繁回复）
MIN_REPLY_INTERVAL=5

# DESIRE_GROWTH_RATE：欲望值增长速率（0.1-1.0，推荐 0.4，结合时间衰减和上下文感知）
DESIRE_GROWTH_RATE=0.4

# MENTION_BONUS：提及 Bot 名称时的额外欲望值（0-1，推荐 0.25，避免过于激进）
MENTION_BONUS=0.25

# MENTION_MUST_REPLY：显式 @ 是否必须回复（true=一律回复；false=由轻量模型判断，推荐）
MENTION_MUST_REPLY=false

# TIME_DECAY_HALFLIFE：时间衰减半衰期（秒，推荐 300=5 分钟，旧消息贡献指数衰减）
TIME_DECAY_HALFLIFE=300

# CONTEXT_WINDOW：上下文感知窗口大小（按消息条数，用于时间衰减计算）
CONTEXT_WINDOW=10

# PACE_FAST_THRESHOLD：快速对话阈值（秒，平均间隔小于此值时降低回复频率）
PACE_FAST_THRESHOLD=15

# PACE_FAST_ADJUSTMENT：快速对话欲望调整幅度（负数=降低欲望值）
PACE_FAST_ADJUSTMENT=-0.1

# PACE_SLOW_THRESHOLD：慢速对话阈值（秒，平均间隔大于此值时提高回复频率）
PACE_SLOW_THRESHOLD=180

# PACE_SLOW_ADJUSTMENT：慢速对话欲望调整幅度（正数=提高欲望值）
PACE_SLOW_ADJUSTMENT=0.08

# BASE_REPLY_THRESHOLD：基础回复概率阈值（0-1，超过此概率才回复）
BASE_REPLY_THRESHOLD=0.65

# MAX_CONCURRENT_PER_SENDER：每个发送方的最大并发任务数（推荐 1，避免多次回复冲突）
MAX_CONCURRENT_PER_SENDER=1

# QUEUE_TIMEOUT：排队任务超时时间（毫秒，超过则丢弃）
QUEUE_TIMEOUT=30000

# SIGMOID_STEEPNESS：Sigmoid 激活函数陡峭度（推荐 6-10，越大越容易“突然爆发”）
SIGMOID_STEEPNESS=8.0

# ENABLE_REPLY_INTERVENTION：是否启用轻量模型干预（在接近阈值时进行二次判断）
ENABLE_REPLY_INTERVENTION=true

# 干预判断使用的轻量模型（建议使用便宜的模型，如 qwen3-8b）
REPLY_INTERVENTION_MODEL=qwen3-8b

# 干预判断超时时间（毫秒，建议9000-15000ms，超时则回退到原判断）
REPLY_INTERVENTION_TIMEOUT=15000

# 是否仅在临界区间触发干预判断（true=仅在概率距离阈值15%以内时触发，节省成本）
REPLY_INTERVENTION_ONLY_NEAR_THRESHOLD=true

# 干预判断为"不需要回复"时，降低欲望值的百分比（0.10=降低10%）
# 降低后重新计算概率，如果仍通过阈值则继续回复，否则跳过
REPLY_INTERVENTION_DESIRE_REDUCTION=0.10

# ===== 消息聚合配置 =====
# 消息聚合窗口（毫秒）。第一条触发回复后，等待此窗口看是否有更多消息加入聚合；
# 若窗口内收到新消息则再次等待一个窗口，直到达到最大等待上限。
BUNDLE_WINDOW_MS=5000
BUNDLE_MAX_MS=15000

# 回复发送间隔（毫秒）
# 多个任务同时完成时，等待此时间后再发送下一个回复，避免消息交错
# 建议 2000-5000ms（2-5秒）
REPLY_SEND_DELAY_MS=2000

# 每个群最多保存的对话对数量（一对 = 1个user消息 + 1个assistant消息）
MAX_CONVERSATION_PAIRS=20

# 最大重试次数（格式验证失败或 Token 超限时）
# 推荐 3-4 次，配合 Prefill 技术可大幅降低重试需求
MAX_RESPONSE_RETRIES=3

# 响应文本token上限
# 建议260-300，根据实际需求调整，防止爆token
MAX_RESPONSE_TOKENS=260

# Token计数使用的模型名称
TOKEN_COUNT_MODEL=gpt-4o-mini

# 是否启用严格格式验证
ENABLE_STRICT_FORMAT_CHECK=true

# Sentra-Emo 服务地址（可选，不配置则使用默认值）
SENTRA_EMO_URL=http://localhost:7200

# Sentra-Emo 请求超时时间（毫秒）
SENTRA_EMO_TIMEOUT=60000

# 是否启用用户画像功能
ENABLE_USER_PERSONA=true

# 画像更新时间间隔（毫秒）- 默认 600000 (10分钟)
# 控制多久可以触发一次画像更新，防止频繁调用 LLM
PERSONA_UPDATE_INTERVAL_MS=600000

# 画像更新消息阈值 - 默认 10 条
# 距离上次更新至少需要积累的新消息数，避免无意义的更新
PERSONA_MIN_MESSAGES=10

# 用户数据存储目录（相对于项目根目录）
PERSONA_DATA_DIR=./userData

# 画像分析使用的模型
PERSONA_MODEL=grok-4

# 最大历史消息保留数
PERSONA_MAX_HISTORY=100

# 最近消息分析窗口（条数）- 用于画像更新时的证据采样
PERSONA_RECENT_MESSAGES=40

# 画像元素半衰期（毫秒）- 默认 172800000 (2天)
# 控制旧画像特征随时间衰减的速度，确保近期特征权重更高
PERSONA_HALFLIFE_MS=172800000

# 性格特征最大数量 - 默认 6
PERSONA_MAX_TRAITS=6

# 兴趣领域最大数量 - 默认 8
PERSONA_MAX_INTERESTS=8

# 行为模式最大数量 - 默认 6
PERSONA_MAX_PATTERNS=6

# 关键洞察最大数量 - 默认 6
PERSONA_MAX_INSIGHTS=6

# 设置为 true 可以跳过 NapCat 自动安装提示（适用于已手动安装的情况）
SENTRA_SKIP_NAPCAT_INSTALL=false

# 覆盖 NapCat 安装文件存放目录（默认写到项目同级 napcat-installer，可改到任意磁盘路径）
NAPCAT_INSTALL_DIR=..

# 覆盖 NapCat Linux Shell 安装脚本的下载地址（默认使用 NapCat 官方镜像）
NAPCAT_INSTALLER_URL=